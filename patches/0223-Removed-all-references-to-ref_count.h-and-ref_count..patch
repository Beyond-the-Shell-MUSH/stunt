From 3c6b51236b587b7fc56b883b5b15ed748133ff7a Mon Sep 17 00:00:00 2001
From: Steve Wainstead <wainstead@gmail.com>
Date: Sun, 1 Jul 2012 15:22:00 -0700
Subject: [PATCH 223/223] Removed all references to ref_count.h and
 ref_count.c

This completes patching Waverous with a change from Stunt. I would
have done better to start with Todd's commit as a patch file; it would
have saved me a little bit of trouble.
---
 server/Makefile.in |  133 ++++++++++++++++++++++++----------------------------
 1 file changed, 60 insertions(+), 73 deletions(-)

diff --git a/server/Makefile.in b/server/Makefile.in
index 0b3e356..0a9a61d 100644
--- a/server/Makefile.in
+++ b/server/Makefile.in
@@ -30,7 +30,7 @@ CSRCS = ast.c code_gen.c db_file.c db_io.c db_objects.c db_properties.c \
 	exceptions.c execute.c extensions.c functions.c keywords.c list.c \
 	log.c match.c md5.c name_lookup.c network.c net_mplex.c \
 	net_proto.c numbers.c objects.c parse_cmd.c pattern.c program.c \
-	property.c quota.c ref_count.c regexpr.c server.c storage.c streams.c str_intern.c \
+	property.c quota.c regexpr.c server.c storage.c streams.c str_intern.c \
 	sym_table.c tasks.c timers.c unparse.c utils.c verbs.c version.c \
 	bg_name_lookup.c
 
@@ -53,7 +53,7 @@ HDRS =  ast.h bf_register.h code_gen.h db.h db_io.h db_private.h decompile.h \
 	getpagesize.h keywords.h list.h log.h match.h md5.h name_lookup.h \
 	network.h net_mplex.h net_multi.h net_proto.h numbers.h opcode.h \
 	options.h parse_cmd.h parser.h pattern.h program.h quota.h random.h \
-	ref_count.h regexpr.h server.h storage.h streams.h structures.h  str_intern.h \
+	regexpr.h server.h storage.h streams.h structures.h  str_intern.h \
 	sym_table.h tasks.h timers.h tokens.h unparse.h utils.h verbs.h \
 	version.h
 
@@ -175,174 +175,161 @@ $(OPT_NET_OBJS):
 
 # DO NOT DELETE THIS LINE -- 'make depend' replaces everything below it.
 ast.o: ast.c my-string.h config.h ast.h parser.h program.h structures.h \
-  my-stdio.h version.h sym_table.h list.h log.h storage.h ref_count.h \
-  utils.h execute.h db.h opcode.h options.h parse_cmd.h
+  my-stdio.h version.h sym_table.h list.h log.h storage.h utils.h \
+  execute.h db.h opcode.h options.h parse_cmd.h
 code_gen.o: code_gen.c ast.h config.h parser.h program.h structures.h \
   my-stdio.h version.h sym_table.h exceptions.h opcode.h options.h \
-  storage.h my-string.h ref_count.h str_intern.h utils.h execute.h db.h \
-  parse_cmd.h my-stdlib.h
+  storage.h my-string.h str_intern.h utils.h execute.h db.h parse_cmd.h \
+  my-stdlib.h
 db_file.o: db_file.c my-stat.h config.h my-unistd.h my-stdio.h \
   my-stdlib.h db.h program.h structures.h version.h db_io.h db_private.h \
   exceptions.h list.h log.h options.h server.h network.h storage.h \
-  my-string.h ref_count.h streams.h str_intern.h tasks.h execute.h \
-  opcode.h parse_cmd.h timers.h my-time.h
+  my-string.h streams.h str_intern.h tasks.h execute.h opcode.h \
+  parse_cmd.h timers.h my-time.h
 db_io.o: db_io.c my-ctype.h config.h my-stdarg.h my-stdio.h my-stdlib.h \
   db_io.h program.h structures.h version.h db_private.h exceptions.h \
-  list.h log.h numbers.h parser.h storage.h my-string.h ref_count.h \
-  streams.h str_intern.h unparse.h
+  list.h log.h numbers.h parser.h storage.h my-string.h streams.h \
+  str_intern.h unparse.h
 db_objects.o: db_objects.c config.h db.h program.h structures.h \
   my-stdio.h version.h db_private.h exceptions.h list.h storage.h \
-  my-string.h ref_count.h utils.h execute.h opcode.h options.h \
-  parse_cmd.h
+  my-string.h utils.h execute.h opcode.h options.h parse_cmd.h
 db_properties.o: db_properties.c config.h db.h program.h structures.h \
   my-stdio.h version.h db_private.h exceptions.h list.h storage.h \
-  my-string.h ref_count.h utils.h execute.h opcode.h options.h \
-  parse_cmd.h
+  my-string.h utils.h execute.h opcode.h options.h parse_cmd.h
 db_verbs.o: db_verbs.c my-stdlib.h config.h my-string.h db.h program.h \
   structures.h my-stdio.h version.h db_private.h exceptions.h db_tune.h \
-  list.h log.h parse_cmd.h storage.h ref_count.h utils.h execute.h \
-  opcode.h options.h
+  list.h log.h parse_cmd.h storage.h utils.h execute.h opcode.h options.h
 decompile.o: decompile.c ast.h config.h parser.h program.h structures.h \
   my-stdio.h version.h sym_table.h decompile.h exceptions.h opcode.h \
-  options.h storage.h my-string.h ref_count.h utils.h execute.h db.h \
-  parse_cmd.h
+  options.h storage.h my-string.h utils.h execute.h db.h parse_cmd.h
 disassemble.o: disassemble.c my-stdio.h config.h bf_register.h db.h \
   program.h structures.h version.h functions.h execute.h opcode.h \
-  options.h parse_cmd.h list.h storage.h my-string.h ref_count.h \
-  streams.h unparse.h utils.h verbs.h
+  options.h parse_cmd.h list.h storage.h my-string.h streams.h unparse.h \
+  utils.h verbs.h
 eval_env.o: eval_env.c config.h eval_env.h structures.h my-stdio.h \
-  version.h storage.h my-string.h ref_count.h sym_table.h utils.h \
-  execute.h db.h program.h opcode.h options.h parse_cmd.h
+  version.h storage.h my-string.h sym_table.h utils.h execute.h db.h \
+  program.h opcode.h options.h parse_cmd.h
 eval_vm.o: eval_vm.c config.h db_io.h program.h structures.h my-stdio.h \
   version.h decompile.h ast.h parser.h sym_table.h eval_vm.h execute.h \
-  db.h opcode.h options.h parse_cmd.h log.h storage.h my-string.h \
-  ref_count.h tasks.h
+  db.h opcode.h options.h parse_cmd.h log.h storage.h my-string.h tasks.h
 exceptions.o: exceptions.c exceptions.h config.h
 execute.o: execute.c my-string.h config.h db.h program.h structures.h \
   my-stdio.h version.h db_io.h decompile.h ast.h parser.h sym_table.h \
   eval_env.h eval_vm.h execute.h opcode.h options.h parse_cmd.h \
   exceptions.h functions.h list.h log.h numbers.h server.h network.h \
-  storage.h ref_count.h streams.h tasks.h timers.h my-time.h utils.h
+  storage.h streams.h tasks.h timers.h my-time.h utils.h
 extensions.o: extensions.c config.h bf_register.h functions.h my-stdio.h \
   execute.h db.h program.h structures.h version.h opcode.h options.h \
   parse_cmd.h db_tune.h my-unistd.h exceptions.h log.h net_multi.h \
-  storage.h my-string.h ref_count.h tasks.h utils.h list.h numbers.h
+  storage.h my-string.h tasks.h utils.h list.h numbers.h
 functions.o: functions.c my-stdarg.h config.h bf_register.h db_io.h \
   program.h structures.h my-stdio.h version.h functions.h execute.h db.h \
   opcode.h options.h parse_cmd.h list.h log.h server.h network.h \
-  storage.h my-string.h ref_count.h streams.h unparse.h utils.h
-keywords.o: keywords.c my-ctype.h config.h my-string.h keywords.h \
-  structures.h my-stdio.h version.h tokens.h ast.h parser.h program.h \
-  sym_table.h y.tab.h utils.h execute.h db.h opcode.h options.h \
-  parse_cmd.h
+  storage.h my-string.h streams.h unparse.h utils.h
+keywords.o: keywords.c my-string.h config.h keywords.h structures.h \
+  my-stdio.h version.h tokens.h ast.h parser.h program.h sym_table.h \
+  y.tab.h utils.h execute.h db.h opcode.h options.h parse_cmd.h
 list.o: list.c my-ctype.h config.h my-string.h bf_register.h exceptions.h \
   functions.h my-stdio.h execute.h db.h program.h structures.h version.h \
   opcode.h options.h parse_cmd.h list.h log.h md5.h pattern.h random.h \
-  ref_count.h streams.h storage.h unparse.h utils.h
+  streams.h storage.h unparse.h utils.h
 log.o: log.c my-stdarg.h config.h my-stdio.h my-string.h my-time.h \
   bf_register.h functions.h execute.h db.h program.h structures.h \
-  version.h opcode.h options.h parse_cmd.h log.h storage.h ref_count.h \
-  streams.h utils.h
+  version.h opcode.h options.h parse_cmd.h log.h storage.h streams.h \
+  utils.h
 match.o: match.c my-stdlib.h config.h my-string.h db.h program.h \
   structures.h my-stdio.h version.h exceptions.h match.h parse_cmd.h \
-  storage.h ref_count.h unparse.h utils.h execute.h opcode.h options.h
+  storage.h unparse.h utils.h execute.h opcode.h options.h
 md5.o: md5.c my-string.h config.h md5.h
 name_lookup.o: name_lookup.c options.h config.h my-signal.h my-stdlib.h \
   my-unistd.h my-inet.h my-in.h my-types.h my-socket.h my-wait.h \
   my-string.h log.h my-stdio.h structures.h server.h network.h storage.h \
-  ref_count.h timers.h my-time.h
+  timers.h my-time.h
 network.o: network.c options.h config.h net_multi.c my-ctype.h my-fcntl.h \
   my-ioctl.h my-signal.h my-stdio.h my-stdlib.h my-string.h my-unistd.h \
   exceptions.h list.h structures.h log.h net_mplex.h net_multi.h \
-  net_proto.h network.h server.h streams.h storage.h ref_count.h timers.h \
-  my-time.h utils.h execute.h db.h program.h version.h opcode.h \
-  parse_cmd.h
+  net_proto.h network.h server.h streams.h storage.h timers.h my-time.h \
+  utils.h execute.h db.h program.h version.h opcode.h parse_cmd.h
 net_mplex.o: net_mplex.c options.h config.h net_mp_selct.c my-string.h \
   my-sys-time.h my-types.h log.h my-stdio.h structures.h net_mplex.h
 net_proto.o: net_proto.c options.h config.h net_bsd_tcp.c my-inet.h \
   my-in.h my-types.h my-socket.h my-stdlib.h my-string.h my-unistd.h \
   list.h structures.h my-stdio.h log.h name_lookup.h net_proto.h server.h \
   network.h streams.h timers.h my-time.h utils.h execute.h db.h program.h \
-  version.h opcode.h parse_cmd.h net_tcp.c exceptions.h
+  version.h opcode.h parse_cmd.h net_tcp.c
 numbers.o: numbers.c my-math.h my-stdlib.h config.h my-string.h my-time.h \
   functions.h my-stdio.h execute.h db.h program.h structures.h version.h \
-  opcode.h options.h parse_cmd.h log.h random.h storage.h ref_count.h \
-  utils.h
+  opcode.h options.h parse_cmd.h log.h random.h storage.h utils.h
 objects.o: objects.c db.h config.h program.h structures.h my-stdio.h \
   version.h db_io.h exceptions.h execute.h opcode.h options.h parse_cmd.h \
   functions.h list.h numbers.h quota.h server.h network.h storage.h \
-  my-string.h ref_count.h utils.h
+  my-string.h utils.h
 parse_cmd.o: parse_cmd.c my-ctype.h config.h my-stdio.h my-stdlib.h \
   my-string.h my-time.h db.h program.h structures.h version.h list.h \
-  match.h parse_cmd.h storage.h ref_count.h utils.h execute.h opcode.h \
-  options.h
+  match.h parse_cmd.h storage.h utils.h execute.h opcode.h options.h
 pattern.o: pattern.c my-ctype.h config.h my-stdlib.h my-string.h \
-  pattern.h regexpr.h storage.h structures.h my-stdio.h ref_count.h \
-  streams.h
+  pattern.h regexpr.h storage.h structures.h my-stdio.h streams.h
 program.o: program.c ast.h config.h parser.h program.h structures.h \
   my-stdio.h version.h sym_table.h exceptions.h list.h storage.h \
-  my-string.h ref_count.h utils.h execute.h db.h opcode.h options.h \
-  parse_cmd.h
+  my-string.h utils.h execute.h db.h opcode.h options.h parse_cmd.h
 property.o: property.c db.h config.h program.h structures.h my-stdio.h \
   version.h functions.h execute.h opcode.h options.h parse_cmd.h list.h \
-  storage.h my-string.h ref_count.h utils.h
+  storage.h my-string.h utils.h
 quota.o: quota.c config.h db.h program.h structures.h my-stdio.h \
   version.h quota.h
-ref_count.o: ref_count.c config.h exceptions.h ref_count.h storage.h \
-  my-string.h structures.h my-stdio.h
 regexpr.o: regexpr.c my-stdio.h config.h regexpr.h my-stdlib.h \
   my-string.h
 server.o: server.c my-types.h config.h my-signal.h my-stdarg.h my-stdio.h \
   my-stdlib.h my-string.h my-unistd.h my-wait.h db.h program.h \
   structures.h version.h db_io.h disassemble.h execute.h opcode.h \
   options.h parse_cmd.h functions.h list.h log.h network.h server.h \
-  parser.h random.h storage.h ref_count.h streams.h tasks.h timers.h \
-  my-time.h unparse.h utils.h
+  parser.h random.h storage.h streams.h tasks.h timers.h my-time.h \
+  unparse.h utils.h
 storage.o: storage.c my-stdlib.h config.h exceptions.h list.h \
-  structures.h my-stdio.h options.h ref_count.h storage.h my-string.h \
-  utils.h execute.h db.h program.h version.h opcode.h parse_cmd.h
+  structures.h my-stdio.h options.h storage.h my-string.h utils.h \
+  execute.h db.h program.h version.h opcode.h parse_cmd.h
 streams.o: streams.c my-stdarg.h config.h my-string.h my-stdio.h log.h \
-  structures.h storage.h ref_count.h streams.h
+  structures.h storage.h streams.h
 str_intern.o: str_intern.c my-stdlib.h config.h log.h my-stdio.h \
-  structures.h storage.h my-string.h ref_count.h str_intern.h utils.h \
-  execute.h db.h program.h version.h opcode.h options.h parse_cmd.h
+  structures.h storage.h my-string.h str_intern.h utils.h execute.h db.h \
+  program.h version.h opcode.h options.h parse_cmd.h
 sym_table.o: sym_table.c my-stdio.h config.h ast.h parser.h program.h \
   structures.h version.h sym_table.h exceptions.h log.h storage.h \
-  my-string.h ref_count.h utils.h execute.h db.h opcode.h options.h \
-  parse_cmd.h
+  my-string.h utils.h execute.h db.h opcode.h options.h parse_cmd.h
 tasks.o: tasks.c my-string.h config.h my-time.h db.h program.h \
   structures.h my-stdio.h version.h db_io.h decompile.h ast.h parser.h \
   sym_table.h eval_env.h eval_vm.h execute.h opcode.h options.h \
   parse_cmd.h exceptions.h functions.h list.h log.h match.h numbers.h \
-  random.h server.h network.h storage.h ref_count.h streams.h tasks.h \
-  utils.h verbs.h
+  random.h server.h network.h storage.h streams.h tasks.h utils.h verbs.h
 timers.o: timers.c my-signal.h config.h my-stdlib.h my-sys-time.h \
   options.h my-types.h my-time.h my-unistd.h timers.h
 unparse.o: unparse.c my-ctype.h config.h my-stdio.h ast.h parser.h \
   program.h structures.h version.h sym_table.h decompile.h exceptions.h \
   functions.h execute.h db.h opcode.h options.h parse_cmd.h keywords.h \
-  list.h log.h unparse.h storage.h my-string.h ref_count.h streams.h \
-  utils.h
+  list.h log.h unparse.h storage.h my-string.h streams.h utils.h
 utils.o: utils.c my-ctype.h config.h my-stdio.h my-string.h db.h \
   program.h structures.h version.h db_io.h exceptions.h list.h log.h \
-  match.h numbers.h ref_count.h server.h network.h options.h storage.h \
-  streams.h utils.h execute.h opcode.h parse_cmd.h
+  match.h numbers.h server.h network.h options.h storage.h streams.h \
+  utils.h execute.h opcode.h parse_cmd.h
 verbs.o: verbs.c my-string.h config.h db.h program.h structures.h \
   my-stdio.h version.h exceptions.h execute.h opcode.h options.h \
   parse_cmd.h functions.h list.h log.h match.h parser.h server.h \
-  network.h storage.h ref_count.h unparse.h utils.h verbs.h
+  network.h storage.h unparse.h utils.h verbs.h
 version.o: version.c config.h version.h
 bg_name_lookup.o: bg_name_lookup.c tasks.h config.h execute.h db.h \
   program.h structures.h my-stdio.h version.h opcode.h options.h \
   parse_cmd.h functions.h utils.h list.h my-in.h my-types.h log.h \
-  exceptions.h net_multi.h storage.h my-string.h ref_count.h server.h \
-  network.h
+  exceptions.h net_multi.h storage.h my-string.h server.h network.h
 ext-FUP.o: ext-FUP.c config.h
 ext-xml.o: ext-xml.c config.h bf_register.h functions.h my-stdio.h \
   execute.h db.h program.h structures.h version.h opcode.h options.h \
-  parse_cmd.h db_tune.h storage.h my-string.h ref_count.h list.h \
-  streams.h utils.h exceptions.h tasks.h
-extension-fileio.o: extension-fileio.c
+  parse_cmd.h db_tune.h storage.h my-string.h list.h streams.h utils.h \
+  exceptions.h tasks.h
+extension-fileio.o: extension-fileio.c my-stat.h config.h my-unistd.h \
+  my-ctype.h my-string.h structures.h my-stdio.h exceptions.h \
+  bf_register.h functions.h execute.h db.h program.h version.h opcode.h \
+  options.h parse_cmd.h list.h storage.h utils.h streams.h server.h \
+  network.h tasks.h log.h
 client_bsd.o: client_bsd.c my-socket.h config.h my-stdio.h my-stdlib.h \
   my-string.h my-sys-time.h options.h my-types.h my-unistd.h
 client_sysv.o: client_sysv.c my-fcntl.h config.h my-signal.h my-stdio.h \
-- 
1.7.9.5

